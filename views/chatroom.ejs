<% layout("layouts/boilerplate") %>

<div class="row m-0 d-flex justify-content-center">
    <div class="col-md-8 col-sm-8 ">
        <h1 id="room-heading"> # <%= currentRoom.name %> </h1>
    </div>
</div>
<div class="row flex-grow-1 d-flex justify-content-center m-0">

    <!-- chat window -->
    <div class="col-md-6 col-sm-6 d-flex flex-column p-0">
        <div id="messages-container" class="flex-grow-1">

            <ul id="messages">
                <% for(let item of messageList) { %>
                <% if(item.sender) { %>
                <li id="<%=item._id%>" class="message-item">
                    <div class="messagepic-container">
                        <%if(item.sender.profilePicUrl){ %>
                        <img class="picture" src="<%=item.sender.profilePicUrl%>" />
                        <% } else {%>
                        <img class="picture" src="/public/images/default.jpg" />
                        <% } %>
                    </div>
                    <div class="message-container">
                        <div class="sender-date-container">
                            <span class="item-sender"> <%= item.sender.username %> </span>
                            <span class="item-date"> <%= item.created.toLocaleDateString("en-US") %>,
                                <%= item.created.toLocaleTimeString("en-US") %> </span>
                        </div>
                        <div class="item-text"> <%= item.chatmessage %> </div>
                    </div>

                    <div class="delete-btn-container">
                        <!-- when hovering over your own messages a delete button will show.  -->
                        <% if(JSON.stringify(signedInUser._id) == JSON.stringify(item.sender._id)){ %>
                        <input class="delete_btn hidden" value="x" type="button" name="<%=item._id%>">
                        <% } %>
                    </div>

                </li>
                <!-- if the senders account is deleted display this instead: -->
                <% } else {%>
                <div>
                    <b> deleted user</b>
                    <span> <%= item.created.toLocaleDateString("en-US") %>,
                        <%= item.created.toLocaleTimeString("en-US") %> </span>
                    <div> <%= item.chatmessage %> </div>
                </div>
                <% } %>
                <% } %>

            </ul>
        </div>

        <form id="chat-form" class="d-flex mt-auto" autocomplete="off">
            <input id="chat-input" type="text" placeholder="Message" class="flex-grow-1">
            <input id="send-btn" type="submit" value="Send" class="ml-auto">
        </form>
    </div>

    <!-- show current users in chat here -->
    <div class="col-md-2 col-sm-3 p-0">
        <div class="users-container">
            <div id="this-user-container">
                logged in as
                <span id="this_user"> <%= signedInUser.username %> </span>
            </div>
            <ul id="user-list">

            </ul>
        </div>
    </div>
</div>
<script src="/socket.io/socket.io.js"></script>
<script src="/public/scripts/chatroom.js"></script>